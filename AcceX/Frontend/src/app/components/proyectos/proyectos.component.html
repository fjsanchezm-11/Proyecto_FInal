<h1>Gestión de Proyectos</h1>

<input type="text" placeholder="Buscar por títulos" [(ngModel)]="busqueda" class="buscador">

<button (click)="mostrarFormulario($event)">➕ Añadir Proyecto</button>

<table class="proyectos-table">
    <thead>
      <tr>
        <th>Acciones</th>
        <th>Título</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let proyecto of proyectosFiltrados">
        <td>
          <button (click)="editarProyecto(proyecto, $event)">✏️ Editar</button>
          <button (click)="eliminarProyecto(proyecto.pid_number)">❌ Eliminar</button>
        </td>
        <td (click)="mostrarDetalles(proyecto)">
          {{ proyecto.titulo }}
        </td>
      </tr>
    </tbody>
  </table>


  <div *ngIf="mostrarForm && !editando" class="popup-form" (click)="onFormClick($event)">
    <div class="popup-content">
      <h2>Nuevo Proyecto</h2>
      <form [formGroup]="proyectoForm" (ngSubmit)="guardarProyecto()">
        <div class="form-group">
          <label>Título:</label>
          <input formControlName="titulo" placeholder="Título">
        </div>
        <div class="form-group">
          <label>Fecha de inicio:</label>
          <input formControlName="fecha_inicio" type="date">
        </div>
        <div class="form-group">
          <label>Fecha de fin:</label>
          <input formControlName="fecha_fin" type="date">
        </div>
        <div class="form-group">
          <label>Email:</label>
          <input formControlName="email">
        </div>
        <div class="form-group">
          <label>Institución:</label>
          <input formControlName="institucion">
        </div>
        <div class="form-group">
          <label>Procedencia:></label>
          <input id="procedencia" formControlName="procedencia">
        </div>
        <div class="form-group">
          <label>Categoría:</label>
          <input id="categoria" formControlName="categoria">
        </div>
        <button type="submit">Guardar</button>
        <button type="button" class="back-button" (click)="cerrarFormulario()">Volver</button>
      </form>
    </div>
  </div>
      
  <!-- FORMULARIO DE EDICIÓN EMERGENTE -->
  <div *ngIf="mostrarForm && editando && proyectoSeleccionado && !mostrandoDetalles" class="popup-form" (click)="onFormClick($event)">
    <div class="popup-content">
      <h2>Editar Proyecto</h2>
      <form [formGroup]="proyectoForm" (ngSubmit)="guardarProyecto()">
        <div class="form-group">
          <label>Título:</label>
          <input formControlName="titulo" placeholder="Título">
        </div>
        <div class="form-group">
          <label>Fecha de inicio:</label>
          <input formControlName="fecha_inicio" type="date">
        </div>
        <div class="form-group">
          <label>Fecha de fin:</label>
          <input formControlName="fecha_fin" type="date">
        </div>
        <div class="form-group">
          <label>Email:</label>
          <input formControlName="email">
        </div>
        <div class="form-group">
          <label>Institución:</label>
          <input formControlName="institucion">
        </div>
        <button type="submit">Actualizar</button>
        <button type="button" class="back-button" (click)="cerrarFormulario()">Volver</button>
      </form>
    </div>
  </div>
  
  <!-- VENTANA EMERGENTE DE INFORMACIÓN SOLO AL PULSAR EL TÍTULO -->
  <div *ngIf="proyectoSeleccionado && mostrandoDetalles" class="popup-form" (click)="cerrarDetalles()">
    <div class="popup-content">
      <h2>Información del Proyecto</h2>
      <p><strong>ID:</strong> {{ proyectoSeleccionado.pid_number }}</p>
      <p><strong>Título:</strong> {{ proyectoSeleccionado.titulo }}</p>
      <p><strong>Fecha de inicio:</strong> {{ proyectoSeleccionado.fecha_inicio | date }}</p>
      <p><strong>Fecha de fin:</strong> {{ proyectoSeleccionado.fecha_fin | date }}</p>
      <p><strong>Institución:</strong> {{ proyectoSeleccionado.institucion }}</p>
      <button class="back-button" (click)="cerrarDetalles()">⬅️ Volver atrás</button>
    </div>
  </div>